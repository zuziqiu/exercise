<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>修改地址</title>
    <link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/base.css" />
    <style type="text/css">
    		* {
			    box-sizing: border-box;
			    -webkit-tap-highlight-color: transparent;
			    -webkit-touch-callout: none;
			}
			html {
			    font-family: sans-serif;
			    -ms-text-size-adjust: 100%;
			    -webkit-text-size-adjust: 100%;
			    font-size: 20px !important;
			}
			body {
			    font-family: "Helvetica Neue",Helvetica,sans-serif;
			    line-height: 1.5;
			    height: 100%;
			}
			.tnavs{
				background-color: #FFFFFF;
				border-bottom:1px solid #f0f0f0;
			    padding-left: 4.4444%;
			    padding-right: 4.4444%;
			    padding-top: 2.6%;
			    padding-bottom: 1.7%;
				box-shadow: 0px 2px 2px rgba(200, 200,200, 1);
			    z-index: 1;
			}
			.tnavs .arrows {
			    /*height: 1.8rem;*/
			    word-spacing: 2rem;
			    font-size: 17px;
			}
			.tnavs .ic_home{
				height:1.1rem;
				font-size: 1.2rem;
				position:absolute;
				top:0;
				bottom:0;
				margin: auto;
				right:4.4444%;
				/*width:10.27778%;*/
				float:right;
			}
    
    
    
    
    /*分割*/
	    #main{
	    	background-color: #fff;
	    }
		/*.am_increase_main,form{
			width: 100%;
		}*/
		.am_increase_main form > div{
			padding:4.4444%;
			font-size: 0.7rem;
			/*font-weight: 600;*/
			border-bottom: 1px solid #f0f0f0;
			background-color: #FFFFFF;
		}
		.am_increase_main form span{
			color: #666666;
			text-align:justify;
			/*text-justify: distribute-all-lines;*/
			text-align-last: justify;
			/*-moz-text-align-last: justify;*/
			width: 25%;
			float: left;
			font-weight: 600;
		}
		.am_increase_main form > div >input{
			border:none;
			outline: none;
			font-size: 0.7rem;
			font-weight: 600;
			margin-left: 8%;
			width:62%;
			overflow: hidden;
			white-space: nowrap;
			text-overflow: ellipsis;
		}
		.ic_rightarrow{
			height:0.8rem;
			color:#10aeff ;
			right:4.4444%;
		}
		.footer{
			width:100%;
			position:fixed;
			bottom:0;
			box-sizing: border-box;
		}
		
		.del_address{
			width: 100%;
		    display: inline-block;
		    background-color: #10aeff;
		    color: #fff;
		    font-size: 1.2rem;
		    border-radius: 0.3rem;
		    padding: 3% 5%;
		    margin:0;font-size: 0.8rem;
		}
		/*修改结果窗口样式*/
		.show{
	   		/*display: none;*/
	   		text-align: center;
	   		width: 100%;
	   		padding-top: 70%;
	   		padding-bottom: 130%;
	   		position: fixed;
	   		top:0;
	   		background-color: rgba(0,0,0,0.1);
	   		z-index: 99;
	  	}
	   	.show>div {
		    width: 53%;
		    background-color: rgba(0,0,0,0.7);
		}
		.ph_success,.im_success,.save_success,.del_success,.save_fail,.del_fail{
	   		text-align: center;
	   		font-size: 18px;
			color: #000000;
			padding-top: 3%;
			padding-bottom: 3%;
			border-radius: 100px;
			color: #FFFFFF;
			font-weight: bold;
			margin-left: auto;
			margin-right: auto;
	   	}
	   	.tnavs{
				position: fixed;
				width: 100%;
				z-index: 99;
				top: 0;
			}
			.tnavs~*:nth-child(2) {
			    margin-top: 12%;
			    background-color: #FFFFFF;
			}
			@media only screen and (min-width: 550px){
				.tnavs~*:nth-child(2){
					margin-top: 7%;
					background-color: #FFFFFF;
				}
			}
			@media only screen and (min-width: 380px) and (max-width: 549px) {
				.tnavs~*:nth-child(2){
					margin-top: 10%;
					background-color: #FFFFFF;
				}
			}
    </style>
</head>
<body>
	<div id="main">
		<div class="tnavs col">
			<b class="arrows"><span class="ic_leftarrow" data-url="-1"></span> 修改地址</b>
			<span class="backmains ic_home"></span>
		</div>
		<div class="am_increase_main">
			<form action="" method="post">
				<div>
					<span class="">收货人</span>
					<input name="Name" class="name" type="text" placeholder="请输入姓名"/>
				</div>
				<div>
					<span class="">联系电话</span>
					<input name="Phone" class="phone" type="tel" placeholder="请输入联系电话"/>
				</div>
				<div>
					<span class="">所在地区</span>
					<input name="AreaAddress" class="areaAddress" type="text" placeholder="请选择所在地区" id='city-picker'/>
					<div class="ic_rightarrow pstion"></div>
					
				</div>
				<div>
					<span class="">详细地址</span>
					<input name="DetailAddress" class="detailAddress" type="text" placeholder="请输入详细地址"/>
				</div>
			</form>
		</div>
		<div class="pad footer">	
			<button class="buy" style="margin:0;font-size: 0.8rem;margin-bottom: 20px;" data-url="">保存</button>
			<button class="del_address" data-url="">删除</button>
		</div>
	</div>
	<div class="sh_loading">
		<div class="loading_mengceng"></div>
		<div class="loadEffect" style="width: 66px;height: 66px">
		    <span></span>
		    <span></span>
		   	<span></span>
		    <span></span>
		    <span></span>
		    <span></span>
		    <span></span>
		    <span></span>
			<!--<p class="loading_tips"></p>-->
		</div>
	</div>
	<!--修改结果提示窗口-->
	<div id="show2" class="show" hidden="">
		<div class="save_success" hidden="">修改成功</div>
		<div class="save_fail" hidden="">修改失败</div>
		<div class="ph_success" hidden="">请输入正确电话</div>
		<div class="im_success" hidden="">信息不能为空</div>
		<div class="del_success" hidden="">删除成功</div>
		<div class="del_fail" hidden="">删除失败</div>
	</div>
	<!--<script src="js/jquery-1.12.2.min.js" type="text/javascript"></script>-->
	<script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
    <script type="text/javascript" src="//g.alicdn.com/msui/sm/0.6.2/js/sm-city-picker.min.js" charset="utf-8"></script>
	<!--<script src="js/base.js" type="text/javascript"></script>-->
	<script>
    window.onload=function(){
	
		//链接首页
		$(".backmains").click(function(){
			location="index.html";
		})
		
		$(".ic_leftarrow").click(function(){
				var go=$(this).attr("data-url");
				if(go==-1){
					history.go(-1);
				}else{
					location=go;
				}
				console.log(go);
		})
		
	    $("#city-picker").cityPicker({
		    toolbarTemplate: '<header class="bar bar-nav">\
		    <button class="button button-link pull-right close-picker">确定</button>\
		    <h1 class="title">选择收货地址</h1>\
		    </header>'
		});
		
		var url = location.href;
		var index=0;
		var modifyID = url.split("?")[1].split(";")[1].split("=")[1];
		var modifyCustID = url.split("?")[1].split(";")[2].split("=")[1];
//		修改信息
		$(".buy").click(function(){
			var a = ($("form").serializeArray());
			//验证手机
			if(!(/^1[34578]\d{9}$/.test(a[1].value))){
				$("#show2,.ph_success").show();
				sh_tips();
				return
			}
			//验证输入合法
			if(a[0].value==""||a[2].value==""||a[3].value==""){
				$("#show2,.im_success").show();
				sh_tips();
				return
			}
			$(".sh_loading").show();
			$.ajax({
				method: "POST",
				async:"true",
				crossDomain:"true",
				"url": "http://test3.msqsoft.net/zkweixin/weiphp/index.php?s=api",
				headers: {
					"Content-Type": "application/x-www-form-urlencoded",
					"Authorization": "Basic QXBpQmFzaWM6MTIz",
					"cache-control": "no-cache",
					"postman-token": "ad69b775-3d16-0a7c-f3f0-a9a4d0d53bac"
				},
				data: {
					"ID": modifyID,
					"CustID": modifyCustID,
					"Name": a[0].value,
					"Phone": a[1].value,
					"AreaAddress": a[2].value,
					"DetailAddress": a[3].value,
					"IsDefault": "True",
					"Type": "M",
					"_api": "Customer/AddCustomerAddress",
				},
				success: function(data) {
//	        	console.log(data);
	        	var save_address = JSON.parse(data);
//		        	console.log(data);
		        	//保存成功
		        	if(save_address.MsgID==1){
		        		$(".sh_loading").hide();
		        		$("#show2,.save_success").show();
		        		setTimeout(function(){
					        $("#show2,.save_success").hide();
					        window.location.href="Address04.html";
					    },2000)
					}	
					//保存失败
					if(data.MsgID==-1){
		        		$(".sh_loading").hide();
		        		$("#show2,.save_fail").show();
			        	sh_tips();
		        	}
	    		}
			});
		});		
		
		//获取点击的地址下标
		if(!!url.split("?")[1]){
			index = url.split("?")[1].slice(";")[0];
		
			$.ajax({
				method: "POST",
				async:"true",
				crossDomain:"true",
				"url": "http://test3.msqsoft.net/zkweixin/weiphp/index.php?s=api",
				headers: {
				    "Content-Type": "application/x-www-form-urlencoded",
				    "Authorization": "Basic QXBpQmFzaWM6MTIz",
				    "cache-control": "no-cache",
				    "postman-token": "ce3ff4e1-42c0-3d94-5335-5dd1c9f9d6c0"
				},
				data: {
				    "CustID": "46E19176-D96C-45CD-A05D-3B777A25191F",
				    "_api": "Customer/GetCustomerAddressList"
				},
				success: function(data) {
		        	var change_address = JSON.parse(data);
//		        	console.log(change_address.Data[index]);
					$(".name").val(change_address.Data[index].Name);
					$(".phone").val(change_address.Data[index].Phone);
					$(".areaAddress").val(change_address.Data[index].AreaAddress);
					$(".detailAddress").val(change_address.Data[index].DetailAddress);
					storageID=change_address.Data[index].ID;
					//删除信息
					$(".del_address").click(function(){
						$(".sh_loading").show();
						$.ajax({
							method: "POST",
							async:"true",
							crossDomain:"true",
							"url": "http://test3.msqsoft.net/zkweixin/weiphp/index.php?s=api",
							headers: {
								"Content-Type": "application/x-www-form-urlencoded",
								"Authorization": "Basic QXBpQmFzaWM6MTIz",
								"cache-control": "no-cache",
			    				"postman-token": "ac6cfccb-4a0a-cd51-216e-8222cdd6e51b"
							},
							data: {
							    "ID": storageID,
							    "BranchId": "3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2",
								"_api": "Customer/DeleteCustomerAddress",
							},
							success: function(response) {
				        		var data = JSON.parse(response);
					        	console.log(data);
					        	//删除成功
					        	if(data.MsgID==1){
					        		$(".sh_loading").hide();
					        		$("#show2,.del_success").show();
					        		setTimeout(function(){
					        			$("#show2,.del_success").hide();
					        			window.location.href="Address04.html";
					        		},2000)
								}
					        	//删除失败
					        	if(data.MsgID==-1){
					        		$(".sh_loading").hide();
					        		$("#show2,.del_fail").show();
						        	sh_tips();
					        	}
				    		}
						});
					});	
		    	}
			});		
		}
		
		//隐藏操作提示
		function sh_tips(){
			if($("#show2").css("display")=="block"){
				setTimeout(function(){
				$("#show2,#show2>div").hide();
				},2000)
			}
		}
	
	}
	</script>
</body>
</html>