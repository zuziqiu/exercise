<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>扫码游戏</title>
		<link rel="stylesheet" href="css/style.css" />
		<link rel="stylesheet" href="css/base.css" />
		<link rel="stylesheet" href="css/header.css" />
		<link rel="stylesheet" type="text/css" href="css/Ga_Gi.css"/>
		<style type="text/css">
			.header {
			    border-bottom: none;
			    font-weight: bold;
			}
			big b {
			    font-size: 1.1rem;
			}
			.header .hright {
			    width: 76%;
			    float: right;
			}
			
			.hright p {
	    		margin-bottom: 5%;
	    	}
	    	
	    	.index_token, .index_lottery, .index_integral, .index_package, .index_tokens, .index_deposit {
			    float: left;
			    display: none;
			}
	    	@media only screen and (min-width: 1000px){
				.header .hright>ol>li{
					background-position-y: 2px;
				}
			}
	    	@media only screen and (min-width: 501px) and (max-width: 1000px) {
				.header .hright>ol>li{
					background-position-y: 2px;
				}
			}
			@media only screen and (min-width: 416px) and (max-width: 500px) {
			.header .hright>ol>li{
					background-position-y: 3px;
				}
			}
			
			@media only screen and (min-width: 361px) and (max-width: 415px) {
				.header .hright>ol>li{
					background-position-y: 2px;
				}
			}
			@media only screen and (min-width: 320px) and (max-width: 360px) {
				.header .hright>ol>li{
					background-position-y: 2px;
				}
			}
			
			.header .hright .jinka {
			    background-color: rgba(252,252,252,0);
			    border-radius: 0.2rem;
			    color: #fff;
			    margin-left: 2%;
			    display: inline-block;
			    vertical-align: bottom;
			    font-weight: 400;
			}
			.sel2{
				padding:4.44444% 6.44444%;
			}
			.info{
				padding-bottom:8%;
			}
			.info>ol{
				border:1px solid #f0f0f0;
				border-radius:0.3rem;
				margin:6% 0 20%;
				padding-bottom:7%;
				background-color:#fbfafc;
			}
			.info>ol>li:nth-of-type(1){
				font-weight:bold;
				text-align:center;
				background-color:#f0f0f0;
			}
			.info>ol>li:nth-of-type(3){
				padding:4% 0 14%;
				margin: 0 4.44444%;
				font-size: 1.8rem;
				font-weight:bold;
				color:#ffbe00;
				text-align: center;
				border-bottom: 1px solid #f0f0f0;
				margin-bottom:4.2222%;
			}
			.pay{
				font-size:4rem;
			}
		</style>
	</head>
	<body>
		<div id="main">
			<div class="tnav col">
				<b class="arrow"><span class="ic_leftarrow" data-url="index.html"></span> 扫码游戏</b>
				<span class="backmain ic_home"></span>
			</div>
			<div class="pad header">
				<img class="hleft" src="img01/people01.png" alt="" />
				<div class="hright">
					<p><span class="col">您好，</span><big><b></b></big><span class="jinka" style="">金卡</span></p>
					<ol class="index_package">
						<li class="col">
							套票<br />
							<b>——</b>
						</li>
					</ol>
					<ol class="index_lottery">
						<li class="col">
							彩票<br />
							<b>——</b>
						</li>
					</ol>
					<ol class="index_integral">
						<li class="col">
							积分<br />
							<b>——</b>
						</li>
					</ol>
					<ol class="index_deposit" style="width: 50px;">
						<li class="col">
							预存款<br />
							<b>——</b>
						</li>
					</ol>
					<ol class="index_token">
						<li class="col">
							币1<br />
							<b>——</b>
						</li>
					</ol>
					<ol class="index_tokens">
						<li class="col">
							币2<br />
							<b>——</b>
						</li>
					</ol>
				</div>
			</div>
			<div class="info pad fz">
				<ol>
					<li class="pad">机台号:<span class="machine_name"></span></li>
					<li class="pad" style="background-color: transparent;">合计:</li>
					<li>
						<span class="pay">0</span>币
					</li>
					<li class="sel2">
						局数:
						<div class="btn1" style="height:2rem;">
							<img src="img01/circle-minus.svg"/ alt="">
							<h2>0</h2>	
							<img src="img01/circle-plus.svg"/ alt="">
						</div>
					</li>
				</ol>
				<button class="buy" style="margin:0" data-url="Msake_1.html" >确认支付</button>
			</div>
		</div>
		<script src="js/jquery-1.12.2.min.js" type="text/javascript"></script>
		<script src="js/base.js" type="text/javascript"></script>
		<script type="text/javascript">
		$(function(){
		   	var count=0;
			$(".btn1>img").eq(0).click(function(){
				if(count>0){
					count--;
					$(".btn1>h2").html(count);
					$(".pay").html(10*count);
				}
			})
			$(".btn1>img").eq(1).click(function(){
				count++;
				$(".btn1>h2").html(count);
				$(".pay").html(10*count);
			})	
			
			//获取会员绑定门店信息
			myajax({
				"cache-control": "no-cache",
				"postman-token": "d88af257-0efe-6f6e-1e63-f638670c7070",
				"data": {
						"_api" :"GetGroupWechatUser/GetGroupWechatUserInfo",
						"OpenID": "ospcgwllZQ98DVrhiKhaVcEjL6zc",
					},
			},'successfn1');	
			//获取机台绑定的价格方案
			myajax({
				"cache-control": "no-cache",
				"postman-token": "d88af257-0efe-6f6e-1e63-f638670c7070",
				"data": {
						"_api" :"PlayStation/GetCustomerPsPrice",
						"CustomerID": "2C1CB150-9F1B-431D-A72F-93BB549631E3",
					    "PlayID": "4B5E70BE-9B0C-4CD7-89FC-ACBA6EFCA36A",
					    "BranchId": "3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2",
					},
			},'successfn3');	
		});
		
		
		
		
//获取会员绑定门店信息
function successfn1(response){
	var data = JSON.parse(response);
	$(".nrights").text(data.Data[0].Name);
		//选择显示会员资产信息
		var settings = {
			"async": true,
		  	"crossDomain": true,
		  	"url": "http://test3.msqsoft.net/zkweixin/weiphp/index.php?s=api&a=getStoreConfig",
		  	"method": "POST",
		 	"headers": {
			    "content-type": "application/x-www-form-urlencoded",
			    "cache-control": "no-cache",
			    "postman-token": "0fa57b46-ee44-f565-9d9e-c64790ddbe98"
		  	},
		  	"data": {
		    	"branchid": data.Data[0].CurrentBranchID,
		  	}
		}
			
	$.ajax(settings).success(function (response) {
		config = response[0].config.split(",");				    
		//获取资产信息
		myajax({ 
		    "cache-control": "no-cache",
		    "postman-token": "304a25c1-ae8f-a9b2-5dda-4cccdde0f2ff",
			data: {
				"_api":"member_info_by_wechat/GetCustomerInfo",
			    "WechatId": "ospcgwllZQ98DVrhiKhaVcEjL6zc",
			    "BranchId": "3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2",
			    "Telephone": "",
				    "CustomerNo": "",
				}
		},'successfn2');				  
	});
}
//获取资产信息
function successfn2(response){
	$("#main >.header >.hright >ol").eq(config[0]-1).css({"position":"absolute","left":"0%","z-index":"8"});
	$("#main >.header >.hright >ol").eq(config[1]-1).css({"position":"absolute","left":"34%","z-index":"8"});
	$("#main >.header >.hright >ol").eq(config[2]-1).css({"position":"absolute","left":"68%","z-index":"8"});
		$.each(config,function(key,val){
		$("#main >.header > .hright > ol").eq(val-1).show();
	});
	console.log("fn2请求成功")
	var index_information = JSON.parse(response);
	index_information.Data.forEach(function(information_binding){
		$(".hright p big b").text(information_binding.SecondName);
		$(".jinka").show().text(information_binding.Level).css({"background-color":"#ffba00"});
		$(".index_package li b").text(information_binding.PackageCount);
		$(".index_token li b").text(information_binding.Coins);
		$(".index_tokens li b").text(information_binding.Coins2);
		$(".index_lottery li b").text(information_binding.Tickets);
		$(".index_integral li b").text(information_binding.Point);
		$(".index_deposit li b").text(information_binding.Money);
	})
	$(".header .hright>ol>li>b").css( {"width":"50px","display":"block"});
};	
//获取机台绑定的价格方案
function successfn3(response){
	var machine_binding = JSON.parse(response);
	console.log(machine_binding);
	$(".machine_name").text(machine_binding.Data2.Name);
}
//判断异步请求相关回调函数
function successfn(response,action){
	if(action=='successfn1'){
		successfn1(response);
		}
	if(action=='successfn2'){
		successfn2(response);
		}
	if(action=='successfn3'){
		successfn3(response);
	}
}							


		</script>
	</body>
</html>
