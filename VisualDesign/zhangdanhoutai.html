<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>账单查询</title>
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/style.css" />
	<style type="text/css">
		/*整体样式*/
		ul{
			margin: 0;
			padding: 0;
			list-style: none;
		}
		
		#arrows{
			height: 1.8rem;
		    word-spacing: 2rem;
		    font-size: 1.2rem;
		}
		/*bill_query_main样式开始*/
		.bill_query,.bill_query_main{
			width: 100%;
			background-color: #FFFFFF;
		}
		
		.bill_query_menu{
			overflow: hidden;
			background-color: #fbfafc;
			text-align: center;
			border-bottom: 1px solid #e6e6e6;
			position: fixed;
			z-index: 1;
			width: 100%;
			margin-top: 0 !important;
			/*padding-top: 10% !important;*/
			top:0;
		}
		.bill_query_main{
			margin-top: 20%;
		}
		@media only screen and (min-width: 451px) and (max-width: 690px) {
	   		.bill_query_menu{
	  			padding-top: 9% !important;
	  		}
	   		.bill_query_main{
	  			margin-top: 22% !important;
	   		}
	   	}
	   	@media only screen and (max-width: 450px) {
	   		.bill_query_menu{
	  			padding-top: 11% !important;
	  		}
	   		.bill_query_main{
	  			margin-top: 24%;
	   		}
	   	}
	   	@media only screen and (max-width: 374px) {
	   		.bill_query_menu{
	  			padding-top: 11% !important;
	  		}
	   		.bill_query_main{
	  			margin-top: 26%;
	   		}
	   	}
	  	@media only screen and (min-width: 700px) {
	  		.bill_query_menu{
	  			padding-top: 7% !important;
	  		}
	   		.bill_query_main{
	  			margin-top: 15.5%;
	   		}
	   	}	
	   	/*@media only screen and (min-width: 370px) and (max-width: 380px) {
	   		.bill_query_menu{
	  			top: 5%;
	   		}
	   	}*/
		.bill_query_menu > span{
			font-weight: bold;
			color: #000000;
			width: 13%;
			float: left;
			padding-top: 5%;
			padding-bottom: 3%;
			margin-left: 6%;
			margin-right: 6%;
			border-bottom: 2px solid #10aeff;
		}
		
		/*充值样式*/
		.bill_query_list{
			border-bottom:1px solid #f0f0f0;
			overflow: hidden;
			padding: 4% 4.444%;
		}
		.bill_query_list > span ,.ic_packagetickets{
			float: left;
			display: block;
		}
		.bill_query_list > span{
			color: #b5b5b5;
			font-size: 14px;
		}
		.bill_query_list > span:first-child{
			position: absolute;
			top: 50%;
			margin-top: -15px;
			width: 75px;
		}
		.money_num{
			font-size:18px;
			color: #000000;
			font-weight: bold;
		}
		
		.font_icon_chongzhi{
			width: 50px;
			height: 50px;
			text-align: center;
			background-color: #ffbe00;
			float: left;
			border-radius: 25px 25px;
			margin-left: 30%;
		}
		.money_db{
			float: left;
			position: absolute;
			top:50%;
			margin-left: 44%;
			margin-top: -19px;
		}
		.db_cz{
			color: #adadad;
			font-size: 12px;
			margin-top: 1%;
		}
		.ic_rightarrow{
				border: none;
				text-align: right;
				float: right;
				font-size: 18px;
				color:#10aeff ;
				position: absolute;
				right: 4.444%;
				top: 50%;
				margin-top: -9px;
			}
		/*公共字体图标样式*/
		.ic_deposit,.ic_packagetickets,.ic_hardware,.ic_token,.ic_lotterytickets,.ic_integral,.ic_gift{
			padding: 11px;
			font-size: 30px;
			color: #FFFFFF;
		}
		/*机台样式*/
		.font_icon_jitai{
		    width: 50px;
		    height: 50px;
		    text-align: center;
		    background-color: #09bb07;
		    float: left;
		    border-radius: 25px 25px;
		    margin-left: 30%;
		}
		/*自助样式*/
		.font_icon_zizhu{
		    width: 50px;
		    height: 50px;
		    text-align: center;
		    background-color: #ffbe00;
		    float: left;
		    border-radius: 25px 25px;
		    margin-left: 30%;
		}
		.font_icon_duihuan{
			width: 50px;
		    height: 50px;
		    text-align: center;
		    background-color: #ff8f40;
		    float: left;
		    border-radius: 25px 25px;
		    margin-left: 30%;
		}
		/*新增结果窗口样式*/
		.show{
			/*display: none;*/
			text-align: center;
			width: 100%;
			padding-top: 70%;
			padding-bottom: 130%;
			position: fixed;
		   	top:0;
		   	background-color: rgba(0,0,0,0.1);
		   	z-index: 99;
		}
		.show>div {
			width: 53%;
			background-color: rgba(0,0,0,0.7);
		}
		.save_success{
		   	text-align: center;
		   	font-size: 18px;
			color: #000000;
			padding-top: 3%;
			padding-bottom: 3%;
			border-radius: 100px;
			color: #FFFFFF;
			font-weight: bold;
			margin-left: auto;
			margin-right: auto;
		}
	</style>
</head>
<body>
	<div class="bill_query">
		<div class="tnav col">
			<b class="arrow"><span class="ic_leftarrow" data-url="index.html"></span> 账单查询</b>
			<span class="backmain ic_home"></span>
		</div>
			
		<!--菜单-->
		<div class="bill_query_menu">
			<span class="bill_menu" id="apo">充值</span>
			<span class="bill_menu" style="border: none;">机台</span>
			<span class="bill_menu" style="border: none;">自动</span>
			<span class="bill_menu" style="border: none;">兑换</span>
		</div>
		<!--/菜单-->
		
		
		<div class="bill_query_main">
			
			<!--充值-->
			<div class="bill_query_content_chongzhi" id="view1">
				<script type="text/html" id="model1">
					{{# for(var i = 0, len = d.Data.length; i < len; i++){ }}
					<div class="bill_query_list">
						<span>{{d.Data[i].Date}}</span>
						<div class="font_icon_chongzhi"><div class="ic_token"></div></div>
						<div class="money_db">
							<span class="money_num">￥{{d.Data[i].Amount}}</span>
							<p class="db_cz">{{d.Data[i].Name}}</p>
						</div>
						<div class="ic_rightarrow"></div>
					</div>
					{{# } }}
				</script>
			</div>
			<!--/充值-->
			
			<!--机台-->
			<div class="bill_query_content_jitai" hidden="" id="view2">
				<script type="text/html" id="model2">
					{{# for(var i = 0, len = d.Data.length; i < len; i++){ }}
					<div class="bill_query_list">
						<span>{{d.Data[i].Date}}</span>
						<div class="font_icon_jitai"><div class="ic_hardware"></div></div>
						<div class="money_db">
							<span class="money_num">￥{{d.Data[i].Amount}}</span>
							<p class="db_cz">{{d.Data[i].Name}}</p>
						</div>
						<div class="ic_rightarrow"></div>
					</div>
					{{# } }}
				</script>
			</div>
			<!--/机台-->
				
			<!--自助-->
			<div class="bill_query_content_zizhu" hidden="" id="view3">
				<script type="text/html" id="model3">
					{{# for(var i = 0, len = d.Data.length; i < len; i++){ }}
					<div class="bill_query_list">
						<span>{{d.Data[i].Date}}</span>
						<div class="font_icon_zizhu"><div class="ic_token"></div></div>
						<div class="money_db">
							<span class="money_num">￥{{d.Data[i].Amount}}</span>
							<p class="db_cz">{{d.Data[i].Name}}</p>
						</div>
						<div class="ic_rightarrow"></div>
					</div>
					{{# } }}
				</script>
			</div>
			<!--/自助-->
			
			<!--兑换-->
			<div class="bill_query_content_duihuan" hidden="" id="view4">
				<script type="text/html" id="model4">
					{{# for(var i = 0, len = d.Data.length; i < len; i++){ }}
					<div class="bill_query_list">
						<span>{{d.Data[i].Date}}</span>
						<div class="font_icon_duihuan" style="background-color: #10aeff;"><div class="ic_integral"></div></div>
						<div class="money_db">
							<span class="money_num">￥{{d.Data[i].Amount}}</span>
							<p class="db_cz">{{d.Data[i].PayType}}</p>
						</div>
						<div class="ic_rightarrow"></div>
					</div>
					{{# } }}
				</script>
			</div>
			<!--/兑换-->
		</div>
	</div>
	<div class="sh_loading" hidden="">
		<div class="loading_mengceng"></div>
		<div class="loadEffect">
		    <span></span>
		    <span></span>
		   	<span></span>
		    <span></span>
		    <span></span>
		    <span></span>
		    <span></span>
		    <span></span>
			<!--<p class="loading_tips"></p>-->
		</div>
	</div>
	<div id="show2" class="show" hidden="">
		<div class="save_success" hidden="">已经到最底了</div>
	</div>
	<script type="text/javascript" src="js/jquery-1.12.2.min.js" ></script>
	<script type="text/javascript" src="js/base.js" ></script>
	<script src="js/laytpl.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/base.js" type="text/javascript"></script>
	<script type="text/javascript">
		window.onload=function(){
			//分类列表点击样式
			$(".bill_menu").click(function(){
				//重置PageIindex
				PageIndex = 1;
				//重置每个分类总数量
				Total = 0;
				_index = $(".bill_menu").index($(this));
				$(this).css("border-bottom","2px solid #10aeff").siblings().css("border-bottom","none");
				$(".bill_query_main").children("div").eq(_index).show().siblings().hide();
			})
			
			//详细列表点击样式
			$(".bill_query_main > div").on('touchstart','.bill_query_list',function(){
				$(this).css("background-color","rgba(111,111,111,0.3)")
			}).on("touchend",".bill_query_list",function(){
				$(this).css("background-color","#fff")
			})
			
			//详细列表点击跳转
			$(".bill_query_content_chongzhi").on('click','.bill_query_list',function(){
				var ItemID =datas.Data[$(this).index()].ItemID;
				//console.log(data.Data[a].Name);
				location.href="zhangdanchaxun01.html?SearchType=0;ItemID="+ItemID;
			});
			$(".bill_query_content_jitai").on('click','.bill_query_list',function(){
				var ItemID =datas.Data[$(this).index()].ItemID;
				//console.log(data.Data[a].Name);
				location.href="zhangdanchaxun01.html?SearchType=1;ItemID="+ItemID;
			});
			$(".bill_query_content_zizhu").on('click','.bill_query_list',function(){
				var ItemID =datas.Data[$(this).index()].ItemID;
				//console.log(data.Data[a].Name);
				location.href="zhangdanchaxun01.html?SearchType=2;ItemID="+ItemID;
			});
			$(".bill_query_content_duihuan").on('click','.bill_query_list',function(){
				var ItemID =datas.Data[$(this).index()].ItemID;
				//console.log(data.Data[a].Name);
				location.href="zhangdanchaxun01.html?SearchType=3;ItemID="+ItemID;
			});
			//各分类列表请求详细列表
			$(".bill_menu").eq(0).click(function(){
				SearchType=0;
				myajax({
					data:{
						"CustID": "2c1cb150-9f1b-431d-a72f-93bb549631e3",
						"PageIndex":"1",
						"PageSize":"10",
						"SearchType":"0",
						"BranchId":"3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2",
						"_api": "CustomerConsume/GetCustomerBill",
					}
				},'successfn1');
			})
			$(".bill_menu").eq(1).click(function(){
				SearchType=1;
				myajax({
					data:{
						"CustID": "2c1cb150-9f1b-431d-a72f-93bb549631e3",
						"PageIndex":"1",
						"PageSize":"10",
						"SearchType":"1",
						"BranchId":"3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2",
						"_api": "CustomerConsume/GetCustomerBill",
					}
				},'successfn2');
			})
			$(".bill_menu").eq(2).click(function(){
				SearchType=2;
				myajax({
					data:{
						"CustID": "2c1cb150-9f1b-431d-a72f-93bb549631e3",
						"PageIndex":"1",
						"PageSize":"10",
						"SearchType":"2",
						"BranchId":"3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2",
						"_api": "CustomerConsume/GetCustomerBill",
					}
				},'successfn3');
			})
			$(".bill_menu").eq(3).click(function(){
				SearchType=3;
				myajax({
					data:{
						"CustID": "2c1cb150-9f1b-431d-a72f-93bb549631e3",
						"PageIndex":"1",
						"PageSize":"10",
						"SearchType":"3",
						"BranchId":"3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2",
						"_api": "CustomerConsume/GetCustomerBill",
					}
				},'successfn4');
			})
			
			//拉下加载更多	
			$(window).scroll(function(){
				scrollTop = $(this).scrollTop();
				scrollHeight = $(document).height();
				windowHeight = $(this).height();
				if(scrollTop + windowHeight == scrollHeight){
					PageIndex = PageIndex+1;
					$("body").on("touchstart",function(){
						x3=0;	//滑动距离重置
						x1=event.touches[0].clientY;
						$(this).on("touchmove",function(){	
							x2=event.touches[0].clientY;
							x3=x2-x1;
						}).on("touchend",function(){
							if(x3<-150&&(scrollHeight - scrollTop - windowHeight <=20 )){
								if(PageIndex>1&&Total==$(".bill_query_main > div").find(".bill_query_list").last().index()+1){
									$("#show2,.save_success").show();
									setTimeout(function(){
										$("#show2,.save_success").hide();
									},1000);
								}
							}
						})
					})
					if(PageIndex>1&&Total==$(".bill_query_main > div").find(".bill_query_list").last().index()+1){return};
					myajax({
						data:{
							"CustID": "2c1cb150-9f1b-431d-a72f-93bb549631e3",
							"PageIndex":PageIndex,
							"PageSize":"10",
							"SearchType":SearchType,
							"BranchId":"3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2",
							"_api": "CustomerConsume/GetCustomerBill",
						}
					},'successfn5');
				}
			});
			//默认点击第一个类别
			$(".bill_menu").eq(0).click();
			//点击隐藏提示框
			$("#show2").click(function(){
				$("#show2,.save_success").hide();
			})
		}
		
		var _index = 0;	    //分类列表所点击下标
		var PageIndex = 1;	//加载页数		
		var Total;			//所属页数详细列表总数量
		var SearchType;     //所查询的类别
		
		function successfn(response,action){
			if(action=='successfn1'){
				successfn1(response);
			}
			if(action=='successfn2'){
				successfn2(response);
			}
			if(action=='successfn3'){
				successfn3(response);
			}
			if(action=='successfn4'){
				successfn4(response);
			}
			if(action=='successfn5'){
				successfn5(response);
			}
		};
		
		//声明
		var data1,data2,data3,data4;  								  //渲染4个分类列表对应的详细列表
		var scrollTop,scrollHeight,windowHeight,selHeight,x1,x2,x3;	  //触摸下拉加载参数
		var view,data,datas,gettpls;                                  //用于处理第2+n次数据加载的渲染
		var gettpl1 = document.getElementById('model1').innerHTML;	  
		var gettpl2 = document.getElementById('model2').innerHTML;
		var gettpl3 = document.getElementById('model3').innerHTML;
		var gettpl4 = document.getElementById('model4').innerHTML;
		//充值渲染
		function successfn1(response){
			//设置view1渲染
			view="view1";
			gettpls=gettpl1;
			data1 = JSON.parse(response);
			Total = data1.Total;
			datas=data1;
			//console.log(data);
			laytpl(gettpl1).render(data1, function(html){
				document.getElementById('view1').innerHTML = html;
			});
			$("body").scrollTop(0);		//切换菜单后列表返回顶部
		}
		//机台渲染
		function successfn2(response){
			//设置view2渲染
			view="view2";
			gettpls=gettpl2;
			data2 = JSON.parse(response);
			Total = data2.Total;
			datas=data2;
//			console.log(data2);
			laytpl(gettpl2).render(data2, function(html){
				document.getElementById('view2').innerHTML = html;
			});
			$("body").scrollTop(0);		//切换菜单后列表返回顶部
		}
		//自动渲染
		function successfn3(response){
			//设置view3渲染
			view="view3";
			gettpls=gettpl3;
			data3 = JSON.parse(response);
			Total = data3.Total;
			datas=data3;
//			console.log(data3);
			laytpl(gettpl3).render(data3, function(html){
				document.getElementById('view3').innerHTML = html;
			});
			$("body").scrollTop(0);		//切换菜单后列表返回顶部
		}
		//兑换渲染
		function successfn4(response){
			//设置view4渲染
			view="view4";
			gettpls=gettpl4;
			data4 = JSON.parse(response);
			Total = data4.Total;
			datas=data4;
//			console.log(data4);
			laytpl(gettpl4).render(data4, function(html){
				document.getElementById('view4').innerHTML = html;
			});
			$("body").scrollTop(0);		//切换菜单后列表返回顶部
		}
		//各分类详细列表下拉渲染
		function successfn5(response){
			data = JSON.parse(response);
			for(var i=0; i < data.Data.length; i++){
				datas.Data.push(data.Data[i]);
			}
			laytpl(gettpls).render(datas, function(html){
				document.getElementById(view).innerHTML = html;
			});
		}
	</script>
</body>
</html>