<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>绑定会员卡</title>
    <!--<link rel="stylesheet" href="css/bangdinghuiyuanka.css" />-->
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/style.css" />
    <style type="text/css">
		.mCard,.mCard_main,.mCard_tips,form{
			width: 100%;
		}
		
		.mCard_tips{
			background-color: #ffbe00;
			width: 92%;
			padding: 4%;
			font-size: 12px;
			color: #ffffff;
			line-height: 18px;
		}
		
		.mCard_main > form div{
			padding-top: 4.44%;
			padding-bottom: 4.44%;
			padding-left: 4%;
			font-size: 14px;
			font-weight: 600;
			border: 1px solid #f0f0f0;
			background-color: #FFFFFF;
		}
		.mCard_main form span{
			color: #666666;
			text-align:justify;
			text-justify: distribute-all-lines;
			text-align-last: justify;
			-moz-text-align-last: justify;
			width: 70px;
			float: left;
			font-weight: 600;
		}
		.mCard_main form > div >input{
			border-style: none;
			outline: none;
			font-size: 14px;
			margin-left: 5%;
			font-weight: 600;
		}
		
		.mCard_main > button{
			border-style: none;
			background-color:#ffbe00 ;
			width: 90%;
			padding-top:3% ;
			padding-bottom: 3%;
			margin-left: 5%;
			border-radius: 8px;
			font-size: 18px;
			color: #ffffff;
			font-weight: bold;
			margin-top: 42%;
			outline: none;
		}
		#bd_mm{
			-webkit-text-security:disc;
		    /*text-security:circle; 使用指定形状代替文字显示 circle圆圈 disc 圆形 square 正方形*/
		}
		/*提示框样式*/
		/*#show{
			display: block;
		}*/
    	.show{
    		display: none;
    		text-align: center;
    		width: 100%;
    		height: 100%;
    		position: fixed;
    		top:0;
    		background-color: rgba(0,0,0,0.5);
    		z-index: 1000;

    	}
    	.show>div{
    		width:70%;
    		margin-top: 60%;
    		padding:0.5rem;
    		border-radius: 2%;
    		display: inline-block;
    		background-color:#fff ;
    	}
    	.show>div>span{
    		width: 100%;
    		font-size: 1.1rem;
    		color: #3AC33F;
    		border-top: 1px solid gainsboro;
    		padding-top: 0.5rem;
    		display: inline-block;
    	}
    	.show p{
    		margin:0.75rem 0;
    		font-size: 0.9rem;
    		font-family: "微软雅黑";
    		
    	}
    	@media only screen and (min-width: 550px){
			.tnav~*:nth-child(2){
				padding-top: 7%;
				background-color: #FFFFFF;
			}
		}
		@media only screen and (min-width: 380px) and (max-width: 549px) {
			.tnav~*:nth-child(2){
				padding-top: 9%;
				background-color: #FFFFFF;
			}
		}
    </style>
</head>
<body>
	
	<div class="mCard">
		<div class="tnav col">
			<b class="arrow"><span class="ic_leftarrow" data-url="index.html"></span> 绑定会员卡</b>
			<span class="backmain ic_home"></span>
		</div>
		<div class="mCard_main">
			<div class="mCard_tips">
				请绑定持卡人本人的会员卡<br/>
				<span><!--赠送10彩票 赠送10积分--></span>
			</div>
			<form action="" method="post" id="mf">
				<div>
					<span class="">会员姓名</span>
					<input type="text" name="bd_xm" id="bd_xm" placeholder="请输入姓名"/>
				</div>
				<div>
					<span class="">手机号</span>
					<input type="tel" name="bd_sj" id="bd_sj" placeholder="请输入手机号"/>
				</div>
				<div>
					<span class="">卡号</span>
					<input type="text" name="bd_kh" id="bd_kh" placeholder="请输入卡号"/>
				</div>
				<div>
					<span class="">密码</span>
					<input type="tel" name="bd_mm" id="bd_mm" maxlength="6" placeholder="请输入新密码" onkeyup="value=value.replace(/[^\d]/g,'')"/>
				</div>
			</form>
			<button class="submit">绑定</button>
		</div>
	</div>
	<!--提示框-->
	<div id="show" class="show">
		<div>	
			<p>请输入正确手机号码</p>
			<span>确认</span>
		</div>
	</div>
	<div id="show2" class="show">
		<div>
			<p></p>
			<span>确认</span>
		</div>
	</div>
	<div class="sh_loading">
		<div class="loading_mengceng"></div>
		<div class="loadEffect">
		    <span></span>
		    <span></span>
		   	<span></span>
		    <span></span>
			<span></span>
		    <span></span>
		    <span></span>
		    <span></span>
			<!--<p class="loading_tips"></p>-->
		</div>
	</div>
	<script type="text/javascript" src="js/jquery-1.12.2.min.js" ></script>
	<script src="http://cdn.bootcss.com/blueimp-md5/1.1.0/js/md5.min.js"></script>  
	<script type="text/javascript" src="js/base.js" ></script>
	<script type="text/javascript">
		//赠送资产
        $.ajax({
			type: "post",
			url: "http://test3.msqsoft.net/zkweixin/weiphp/index.php?s=api",
			dataType: "json",
			"headers": {
				"content-type": "application/x-www-form-urlencoded; charset=utf-8",
				"Authorization": "Basic QXBpQmFzaWM6MTIz",
				"cache-control": "no-cache",
				"postman-token": "13818c96-3f13-5072-2f4a-552d6cea9409"
			},
			data: {
				"CustID": "2c1cb150-9f1b-431d-a72f-93bb549631e3",
				"_api": "BindingPresent/GetBindingPresent",
			},
			success: function(response) {
				$(".sh_loading").hide();
//		        $("#show2").show();
//		        $("#show2>div>p").eq(0).text(data.ResultMsg);
//		        if(response.Data !=""){
		        	$(".mCard_tips span").html("");
		        	if(!!response.Data.Ticket){$(".mCard_tips span").append("赠送"+response.Data.Ticket+"彩票 ")};
			        if(!!response.Data.Point){$(".mCard_tips span").append("赠送"+response.Data.Point+"积分 ")};
			        if(!!response.Data.Coin1){$(".mCard_tips span").append("赠送"+response.Data.Coin1+"币1 ")};
			        if(!!response.Data.Coin2){$(".mCard_tips span").append("赠送"+response.Data.Coin2+"币2 ")};
			        if(!!response.Data.Money){$(".mCard_tips span").append("赠送"+response.Data.Money+"预存款")};
//		        }
			}
		});
		//赠送资产end
		//声明				
		var name,numb,pass,txt;
		//获取表单输入的数据
		$("#bd_xm").add("#bd_kh").add("#bd_mm").blur(function(){
			  name = $("#bd_xm").val();
			  numb = $("#bd_kh").val();
			  pass = $("#bd_mm").val();
		});
		
		
		$(".submit").click(function(){
			txt = $("#bd_sj").val();
			checkMobile(txt);
			//console.log(name,numb,pass);
			//console.log(txt);
			//console.log($("form").serialize());
			
		});
		
			//手机号码判断
		function checkMobile(str) {
		    if(str==""){
		        $("#show").show();
		           $("#show>div>span").click(function(){
		           	 $("#show").hide();
		           })
		    }
		    else{
		        var re = /^1[3|4|5|8]\d{9}$/;
		        if (re.test(str)) {
		            info();
		        } else {
		            $("#show").show();
		           	$("#show>div>span").click(function(){
		           	 	$("#show").hide();
		           })
		        }
		    }
		}
		
	
		function info(){
			var Random = Math.floor(Math.random()*1000);
			var Collate = md5( 
				"Phone"+txt+
				"WechatNo"+numb+
				"BranchID"+"3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2"+
				"Password"+pass+
				"OpenID"+"ospcgwllZQ98DVrhiKhaVcEjL6zc"+
				"Name"+name+
				"Random"+Random+
				"huake1212"
			);
			$.ajax({
				type: "post",
				url: "http://test3.msqsoft.net/zkweixin/weiphp/index.php?s=api",
				dataType: "json",
				"headers": {
				    "content-type": "application/x-www-form-urlencoded; charset=utf-8",
				    "Authorization": "Basic QXBpQmFzaWM6MTIz",
				    "cache-control": "no-cache",
				    "postman-token": "13818c96-3f13-5072-2f4a-552d6cea9409"
				},
				data: {
					"Phone": txt,
				    "WechatNo": numb,
				    "BranchID": "3D7775B5-33D1-4348-B3AA-4CFD9AEEC0D2",
				    "Password": pass,
				    "OpenID": "ospcgwllZQ98DVrhiKhaVcEjL6zc",
					"Name":name,
				    "Random": Random,
				    "Collate": Collate,
				    "_api": "MemberBinding/MemberBind",
				},
				success: function(data) {
//      			console.log(data);
					$(".sh_loading").hide();
        			if(data.ResultCode == 0){
        				$("#show2").show();
		       			$("#show2>div>p").eq(0).text(data.ResultMsg);
        				$("#show2>div>span").click(function(){
						    $("#show2").hide();
					        location.href="index.html";
						})
        			}else{
        				$("#show2").show();
        				$("#show2>div>p").text(data.ResultMsg);
        				$("#show2>div>span").click(function(){
		           			$("#show2").hide();
		           		})
        			}
    			}
			});
		}
	</script>
</body>
</html>