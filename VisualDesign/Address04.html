<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>地址管理</title>
		    <!--<link rel="stylesheet" href="//g.alicdn.com/msui/sm/0.6.2/css/sm.min.css">-->
		<link rel="stylesheet" href="css/style.css" />
		<link rel="stylesheet" href="css/base.css" />
		<link rel="stylesheet" type="text/css" href="css/Ga_Gi.css"/>
		<style type="text/css">
			* {
			    box-sizing: border-box;
			    -webkit-tap-highlight-color: transparent;
			    -webkit-touch-callout: none;
			}
			html {
			    font-family: sans-serif;
			    -ms-text-size-adjust: 100%;
			    -webkit-text-size-adjust: 100%;
			    font-size: 20px;
			}
			body {
			    font-family: "Helvetica Neue",Helvetica,sans-serif;
			    line-height: 1.5;
			}
			.tnavs{
				background-color: #FFFFFF;
				border-bottom:1px solid #f0f0f0;
			    padding-left: 4.4444%;
			    padding-right: 4.4444%;
			    padding-top: 2.6%;
			    padding-bottom: 1.7%;
				box-shadow: 0px 2px 2px rgba(200, 200,200, 1);
			    z-index: 1;
			}
			.tnavs .arrows {
			    /*height: 1.8rem;*/
			    word-spacing: 2rem;
			    font-size: 17px;
			}
			.tnavs .ic_home{
				height:1.1rem;
				font-size: 1.2rem;
				position:absolute;
				top:0;
				bottom:0;
				margin: auto;
				right:4.4444%;
				/*width:10.27778%;*/
				float:right;
			}
			h2 {
			    line-height: 1.2rem;
			    font-size: 0.8rem;
			}
			.sel>.sel2>ol>li{
				 font-size: 0.6rem;
			}
			/*#main{
				background-color:#fff;
			}*/
			.sel{
				margin-bottom:16%;
			}
			.sel>:nth-child(n){
				padding:3.8% 6.44444%;
				border-bottom:1px solid #f0f0f0;
			}
			.sel .sel2,.sel1>:nth-child(n){
				background-color:#fff;
				transition:0.5s all;
			}
			.default_y{
				display: none;
			}
			.sel2>ol{
				margin-left: 31px;
			}
			.go>li>div,.sel2>div{
				height:1rem;
			}
			.sel2>div{
				padding: 0 10px;
			}
			.footer{
				width:100%;
				position:absolute;
				bottom:0;
				/*margin-bottom:4.4444%;*/
				box-sizing: border-box;
			}
			.am_empty_main{
				width: 100%;
			}
			.am_empty_main{
				padding-top: 20%;
			}
			.ic_address{
				padding-top: 30%;
				text-align: center;
				font-size: 6rem;
				color: #a3adc4;
				background-color: #efeff4
			}
			.am_empty_tips{
				color: #a8b1c7;
				text-align: center;
				padding-top: 1.5rem;
				font-size: 0.9rem;
				/*font-size: 20px;*/
				/*font-size: 300%;*/
				font-weight: bold;
				background-color: #efeff4
			}		
			.footer{
				width:100%;
				position:absolute;
				bottom:0;
				box-sizing: border-box;
			}   
			.buy{
				font-size: 0.8rem !important;
				padding: 3.85% 5% !important;
			}
			/*默认地址样式*/
			.default_address{
				height: 100% ;
				width: 31px;
				float: left;
				padding: 0 !important;
				border: none !important;
				position: static !important; 
				margin-left: -3% !important;
			}
			.default_address img{
				position: absolute;
				top: 50% !important;
				margin-top: -17px !important;
			}
			.sel>.sel2 .default_address img:last-child{
				display: none;
			}
			/*修改结果窗口样式*/
			.show{
		   		/*display: none;*/
		   		text-align: center;
		   		width: 100%;
		   		padding-top: 70%;
		   		padding-bottom: 130%;
		   		position: fixed;
		   		top:0;
		   		background-color: rgba(0,0,0,0.1);
		   		z-index: 99;
		  	}
		   	.show>div {
			    width: 53%;
			    background-color: rgba(0,0,0,0.7);
			}
			.ph_success,.im_success,.save_success,.del_success,.save_fail,.del_fail{
		   		text-align: center;
		   		font-size: 18px;
				color: #000000;
				padding-top: 3%;
				padding-bottom: 3%;
				border-radius: 100px;
				color: #FFFFFF;
				font-weight: bold;
				margin-left: auto;
				margin-right: auto;
		   	}
			.tnavs{
				position: fixed;
				width: 100%;
				z-index: 99;
				top: 0;
			}
			.tnavs~*:nth-child(3) {
			    margin-top: 12%;
			    background-color: #FFFFFF;
			}
			@media only screen and (min-width: 550px){
				.tnavs~*:nth-child(3){
					margin-top: 7%;
					background-color: #FFFFFF;
				}
			}
			@media only screen and (min-width: 380px) and (max-width: 549px) {
				.tnavs~*:nth-child(3){
					margin-top: 10%;
					background-color: #FFFFFF;
				}
			}
		</style>
	</head>
	<body>
		<div id="main">
			<div class="tnavs col">
				<b class="arrows"><span class="ic_leftarrow" data-url="-1"></span> 地址管理</b>
				<span class="backmains ic_home"></span>
			</div>
			<div class="am_empty_main">
				<div class="ic_address"></div>
				<div class="am_empty_tips">
					请通过下方按钮新增地址
				</div>
			</div>
			<ol class="sel" id="view">
				<!--<li class="sel2">
					<div class="default_address">
						<img src="img/mg03.png" alt="" />
						<img class="default_y" style="display:none" src="img/mg04.png" alt="" />
					</div>
					<ol>
						<h2>王某某-133XXXXXXXX</h2>
						<li class="col">
							广东省 广州市 番禺区
						</li>
						<li class="col">
							番禺大道北1451号捷艺产业发展大夏6楼
						</li>
					</ol>
					<div>
						<span class="rang ic_rightarrow"></span>
					</div>
				</li>-->
				<script type="text/html" id="model">
					{{# for(var i = 0, len = d.Data.length; i < len; i++){ }}
						<li class="sel2">
							<div class="default_address">
								<img src="img/mg03.png" alt="" />
								<img class="default_y" src="img/mg04.png" alt="" />
							</div>
							<ol>
								<h2>{{d.Data[i].Name}} - {{d.Data[i].Phone}}</h2>
								<li class="col">
									{{d.Data[i].AreaAddress}}
								</li>
								<li class="col">
									{{d.Data[i].DetailAddress}}
								</li>
							</ol>
							<div>
								<span class="rang ic_rightarrow"></span>
							</div>
						</li>
					{{# } }}
				</script>
			</ol>
			<div class="pad footer" style="position: fixed;">	
				<button class="buy" style="margin:0;" data-url="Address03.html">新增地址</button>
			</div>
		</div>
		<div class="sh_loading" hidden="">
		<div class="loading_mengceng"></div>
		<div class="loadEffect" style="width: 66px;height: 66px;">
		    <span></span>
		    <span></span>
		   	<span></span>
		    <span></span>
		    <span></span>
		    <span></span>
		    <span></span>
		    <span></span>
			<!--<p class="loading_tips"></p>-->
		</div>
		</div>
		<!--修改结果提示窗口-->
		<div id="show2" class="show" hidden="">
			<div class="save_success" hidden="">修改默认地址成功</div>
			<div class="save_fail" hidden="">修改默认地址失败</div>
		</div>
		<script src="js/jquery-1.12.2.min.js" type="text/javascript"></script>
		<script src="js/laytpl.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/base.js" type="text/javascript"></script>
		<!--<script src="js/Address.js"></script>-->
		<script>
			$(function(){
				//链接首页
				$(".backmains").click(function(){
					location="index.html";
				})
				
				$(".ic_leftarrow").click(function(){
					location="index.html";
				})
				
				$(".sel2").on("touchstart",function(){
					$(this).css("background-color","rgba(111,111,111,0.3)")
				}).on("touchend",function(){
					$(this).css("background-color","#fff")
				});
					
					
				myajax({
					'data':{
						 "CustID": "46E19176-D96C-45CD-A05D-3B777A25191F",
						 "_api": "Customer/GetCustomerAddressList",
						}
					},'successfn1');
					

			});
			
			var address_information=[];
			var transmit_address;
			var modifyID;
			var modifyCustID;
			var ix
				//获取地址列表
				function successfn1(response){
					var data = JSON.parse(response);
					address_information = data.Data;
					if(address_information.length>0){
						$(".am_empty_main").hide();
					}
					//动态插入渲染
					var gettpl = document.getElementById('model').innerHTML;
					 laytpl(gettpl).render(data, function(html){
						document.getElementById('view').innerHTML = html;
					});
					//显示默认的地址
					data.Data.forEach(function(obj,index){
						if(obj.IsDefault){
							$(".sel2").eq(index).find(".default_y").css({"display":"block"})
						}
					});
					//跳转、传递参数至修改地址
					for(var i=0;i<address_information.length;i++){
					 	$(".sel").on("click","ol",function(){
							var index = $(this).parent().index();
							console.log(index)
							modifyID = data.Data[index].ID;
							modifyCustID = data.Data[index].CustID;
							location.href="Address05.html?"+index+";modifyID="+data.Data[index].ID+";modifyCustID="+data.Data[index].CustID;
					 	});
					}
					//通过勾选设置默认地址
					for(var i=0;i<address_information.length;i++){
					 	$(".sel").on("click",".default_address>img",function(){
							ix= $(this).parent().parent().index();
							modifyID = data.Data[ix].ID;
							modifyCustID = data.Data[ix].CustID;
							myajax({
									"cache-control": "no-cache",
	    							"postman-token": "f7329686-15ac-8126-103c-2724d4c3ccdc",
								data:{
									"ID": modifyID,
									"CustID": modifyCustID,
									"Name": data.Data[ix].Name,
									"Phone": data.Data[ix].Phone,
									"AreaAddress": data.Data[ix].AreaAddress,
									"DetailAddress": data.Data[ix].DetailAddress,
									"IsDefault": "True",
									"Type": "M",
									"_api": "Customer/AddCustomerAddress",
									}
							},'successfn2');
					 	});
					}					
				}
				
				//通过勾选设置默认地址
				function successfn2(response){
					var save_address = JSON.parse(response);
					if(save_address.MsgID==1){
			        	$(".sh_loading").hide();
			        	$("#show2,.save_success").show();
						$(".sel2").eq(ix).find(".default_y").css({"display":"block"}).end().siblings().find(".default_y").css({"display":"none"});
			        	setTimeout(function(){
						    $("#show2,.save_success").hide();
						},2000)
					}	
				}
				//判断异步请求相关回调函数
				function successfn(response,action){
					if(action=='successfn1'){
						successfn1(response);
					}	
					if(action=='successfn2'){
						successfn2(response);
					}
							
					if(action=='successfn3'){
						successfn3(response);
					}
				};
		</script>
	</body>
</html>